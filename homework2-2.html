<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼ë‹¨í•©ê²© JLPT N2 ë‹¨ì–´ì¥ (ì„ ì§€í˜•)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap');
        body { font-family: 'Noto Sans KR', 'Noto Sans JP', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .choice-btn { transition: all 0.2s; }
        .choice-btn:active { transform: scale(0.98); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white rounded-xl shadow-lg w-full max-w-md overflow-hidden">
        <div id="header-bg" class="bg-emerald-600 p-4 text-white text-center transition-colors duration-500">
            <h1 id="header-title" class="text-xl font-bold">JLPT N2 ë‹¨ì–´ì¥</h1>
            <p id="header-desc" class="text-sm opacity-80">4ì§€ ì„ ë‹¤í˜• í€´ì¦ˆ (ëœ» â†’ ë°œìŒ)</p>
        </div>

        <div class="bg-gray-200 h-2 w-full">
            <div id="progress-bar" class="bg-emerald-400 h-2 transition-all duration-300" style="width: 0%"></div>
        </div>

        <div id="quiz-container" class="p-6 text-center fade-in">
            <div class="mb-6">
                <span class="text-sm text-gray-500 mb-1 block">ë¬¸ì œ <span id="current-index">1</span> / <span id="total-count">10</span></span>
                <h2 id="question-word" class="text-6xl font-bold text-gray-800 mb-2 min-h-[4.5rem]"></h2>
                <p id="step-label" class="text-emerald-600 font-bold text-sm mb-1"></p>
                <p id="hint-text" class="text-gray-500 text-sm h-5"></p>
            </div>

            <div id="choices-container" class="grid grid-cols-1 gap-3 mb-2">
                </div>

            <div id="feedback" class="h-8 text-sm font-bold flex items-center justify-center"></div>
        </div>

        <div id="result-container" class="hidden p-8 text-center fade-in">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">í€´ì¦ˆ ì™„ë£Œ! ğŸ‰</h2>
            <p class="text-lg mb-6 text-gray-600">
                ì´ <span id="final-score" class="font-bold text-emerald-600 text-2xl"></span>ì ì„ íšë“í–ˆìŠµë‹ˆë‹¤.
            </p>
            
            <div id="review-section" class="hidden mb-6 bg-red-50 p-4 rounded-lg border border-red-200">
                <p class="text-red-600 font-bold mb-2">í‹€ë¦° ë‹¨ì–´ê°€ <span id="wrong-count">0</span>ê°œ ìˆìŠµë‹ˆë‹¤.</p>
                <button onclick="startReview()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-lg shadow transition-colors">
                    í‹€ë¦° ë‹¨ì–´ë§Œ ë³µìŠµí•˜ê¸° ğŸ”„
                </button>
            </div>

            <button onclick="location.reload()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-lg shadow transition-colors">
                ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸° (ì „ì²´ ë¦¬ì…‹)
            </button>
        </div>
    </div>

    <script>
        // ì—¬ê¸°ì— ì´ì „ì— ë“œë¦° ì „ì²´ vocabularyDataë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!
        // ì˜ˆì‹œ ë°ì´í„° (í…ŒìŠ¤íŠ¸ìš©)
        const vocabularyData = [
            { kanji: "ç›¸äº’", kana: "ãã†ã”", meaning: ["ìƒí˜¸", "ì„œë¡œ"] },
            { kanji: "è£œã†", kana: "ãŠããªã†", meaning: ["ë³´ì™„í•˜ë‹¤", "ë³´ì¶©í•˜ë‹¤"] },
            { kanji: "è‡³æ€¥", kana: "ã—ãã‚…ã†", meaning: ["ì§€ê¸‰", "ë§¤ìš° ê¸‰í•¨"] },
            { kanji: "ç‡ç›´ãª", kana: "ãã£ã¡ã‚‡ããª", meaning: ["ì†”ì§í•œ"] },
            { kanji: "è¦æ¨¡", kana: "ãã¼", meaning: ["ê·œëª¨"] },
            // ... (ì „ì²´ ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”) ...
        ];

        let currentIndex = 0;
        let score = 0;
        let currentStep = 'meaning'; // 'meaning' or 'reading'
        let quizList = [];
        let incorrectList = [];
        let isReviewMode = false;
        let isProcessing = false; // ì¤‘ë³µ í´ë¦­ ë°©ì§€

        // DOM ìš”ì†Œ
        const elements = {
            questionWord: document.getElementById('question-word'),
            stepLabel: document.getElementById('step-label'),
            hintText: document.getElementById('hint-text'),
            choicesContainer: document.getElementById('choices-container'),
            feedback: document.getElementById('feedback'),
            progressBar: document.getElementById('progress-bar'),
            currentIndex: document.getElementById('current-index'),
            totalCount: document.getElementById('total-count'),
            quizContainer: document.getElementById('quiz-container'),
            resultContainer: document.getElementById('result-container'),
            finalScore: document.getElementById('final-score'),
            reviewSection: document.getElementById('review-section'),
            wrongCount: document.getElementById('wrong-count'),
            headerBg: document.getElementById('header-bg'),
            headerTitle: document.getElementById('header-title'),
            headerDesc: document.getElementById('header-desc')
        };

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initQuiz() {
            quizList = shuffleArray([...vocabularyData]);
            incorrectList = [];
            isReviewMode = false;
            score = 0;
            currentIndex = 0;
            updateHeaderUI();
            startCycle();
        }

        function startReview() {
            quizList = shuffleArray([...incorrectList]);
            incorrectList = [];
            isReviewMode = true;
            score = 0;
            currentIndex = 0;
            
            elements.resultContainer.classList.add('hidden');
            elements.quizContainer.classList.remove('hidden');
            updateHeaderUI();
            startCycle();
        }

        function updateHeaderUI() {
            if (isReviewMode) {
                elements.headerBg.className = "bg-orange-500 p-4 text-white text-center transition-colors duration-500";
                elements.headerTitle.innerText = "ì˜¤ë‹µ ë³µìŠµ ëª¨ë“œ";
                elements.headerDesc.innerText = "í‹€ë¦° ë‹¨ì–´ë¥¼ í™•ì‹¤í•˜ê²Œ ì™¸ì›Œë´…ì‹œë‹¤!";
            } else {
                elements.headerBg.className = "bg-emerald-600 p-4 text-white text-center transition-colors duration-500";
                elements.headerTitle.innerText = "JLPT N2 ë‹¨ì–´ì¥";
                elements.headerDesc.innerText = "4ì§€ ì„ ë‹¤í˜• í€´ì¦ˆ (ëœ» â†’ ë°œìŒ)";
            }
        }

        function startCycle() {
            elements.totalCount.innerText = quizList.length;
            loadQuestion();
        }

        function loadQuestion() {
            const currentData = quizList[currentIndex];
            elements.currentIndex.innerText = currentIndex + 1;
            
            const progress = (currentIndex / quizList.length) * 100;
            elements.progressBar.style.width = `${progress}%`;

            elements.questionWord.innerText = currentData.kanji;
            elements.feedback.innerText = '';
            
            currentStep = 'meaning';
            renderChoices();
            isProcessing = false;
        }

        function renderChoices() {
            const currentData = quizList[currentIndex];
            elements.choicesContainer.innerHTML = ''; // ê¸°ì¡´ ë²„íŠ¼ ì‚­ì œ

            let correctAnswer = '';
            let distractors = [];

            if (currentStep === 'meaning') {
                // ëœ» ë§ì¶”ê¸°
                elements.stepLabel.innerText = "Q. ì˜¬ë°”ë¥¸ ëœ»ì€?";
                elements.hintText.innerText = "";
                correctAnswer = currentData.meaning.join(', ');

                // ì˜¤ë‹µ ìƒì„± (í˜„ì¬ ì •ë‹µì´ ì•„ë‹Œ ê²ƒë“¤ ì¤‘ì—ì„œ ëœë¤ 3ê°œ)
                const others = vocabularyData.filter(item => item.kanji !== currentData.kanji);
                const randomOthers = shuffleArray(others).slice(0, 3);
                distractors = randomOthers.map(item => item.meaning.join(', '));

            } else {
                // ë°œìŒ ë§ì¶”ê¸°
                elements.stepLabel.innerText = "Q. ì˜¬ë°”ë¥¸ ë°œìŒ(ìš”ë¯¸ê°€ë‚˜)ì€?";
                elements.hintText.innerText = `ëœ»: ${currentData.meaning.join(', ')}`;
                correctAnswer = currentData.kana;

                const others = vocabularyData.filter(item => item.kanji !== currentData.kanji);
                const randomOthers = shuffleArray(others).slice(0, 3);
                distractors = randomOthers.map(item => item.kana);
            }

            // ì •ë‹µ + ì˜¤ë‹µ ì„ê¸°
            const options = shuffleArray([correctAnswer, ...distractors]);

            // ë²„íŠ¼ ìƒì„±
            options.forEach(option => {
                const btn = document.createElement('button');
                btn.className = "choice-btn w-full bg-white border-2 border-gray-200 hover:border-emerald-500 hover:bg-emerald-50 text-gray-700 font-bold py-4 rounded-xl text-lg shadow-sm";
                btn.innerText = option;
                btn.onclick = () => checkAnswer(btn, option === correctAnswer, correctAnswer);
                elements.choicesContainer.appendChild(btn);
            });
        }

        function checkAnswer(btnElement, isCorrect, correctAnswerText) {
            if (isProcessing) return;
            isProcessing = true;

            const currentData = quizList[currentIndex];

            if (isCorrect) {
                // ì •ë‹µ ì²˜ë¦¬
                btnElement.className = "choice-btn w-full bg-emerald-500 border-2 border-emerald-600 text-white font-bold py-4 rounded-xl text-lg shadow-md"; // ì´ˆë¡ìƒ‰
                
                if (currentStep === 'meaning') {
                    elements.feedback.className = "text-emerald-600";
                    elements.feedback.innerText = "ì •ë‹µ! â­• ë°œìŒë„ ë§ì¶°ë³´ì„¸ìš”.";
                    setTimeout(() => {
                        currentStep = 'reading';
                        renderChoices();
                        isProcessing = false;
                    }, 800);
                } else {
                    // ë°œìŒê¹Œì§€ ë§ì¶¤ -> ì ìˆ˜ íšë“
                    score++;
                    elements.feedback.className = "text-emerald-600";
                    elements.feedback.innerText = "ì™„ë²½í•©ë‹ˆë‹¤! â­•";
                    setTimeout(() => {
                        nextQuestion();
                    }, 800);
                }

            } else {
                // ì˜¤ë‹µ ì²˜ë¦¬
                btnElement.className = "choice-btn w-full bg-red-500 border-2 border-red-600 text-white font-bold py-4 rounded-xl text-lg shadow-md"; // ë¹¨ê°„ìƒ‰
                addIncorrectWord(currentData);

                // ì •ë‹µ ë²„íŠ¼ ì°¾ì•„ì„œ í‘œì‹œí•´ì£¼ê¸°
                const buttons = elements.choicesContainer.getElementsByTagName('button');
                for (let btn of buttons) {
                    if (btn.innerText === correctAnswerText) {
                        btn.className = "choice-btn w-full bg-emerald-500 border-2 border-emerald-600 text-white font-bold py-4 rounded-xl text-lg shadow-md opacity-70";
                    }
                }

                elements.feedback.className = "text-red-500";
                elements.feedback.innerText = "ì˜¤ë‹µì…ë‹ˆë‹¤ âŒ ì •ë‹µì„ í™•ì¸í•˜ì„¸ìš”.";

                // ì˜¤ë‹µ í™•ì¸ ì‹œê°„ (1.5ì´ˆ) í›„ ì§„í–‰
                setTimeout(() => {
                    if (currentStep === 'meaning') {
                        // ëœ» í‹€ë¦¼ -> ë°œìŒìœ¼ë¡œ ë„˜ì–´ê°
                        currentStep = 'reading';
                        renderChoices();
                        isProcessing = false;
                    } else {
                        // ë°œìŒ í‹€ë¦¼ -> ë‹¤ìŒ ë¬¸ì œ
                        nextQuestion();
                    }
                }, 1500);
            }
        }

        function addIncorrectWord(wordObj) {
            if (!incorrectList.includes(wordObj)) {
                incorrectList.push(wordObj);
            }
        }

        function nextQuestion() {
            currentIndex++;
            if (currentIndex < quizList.length) {
                loadQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            elements.quizContainer.classList.add('hidden');
            elements.resultContainer.classList.remove('hidden');
            elements.finalScore.innerText = score + " / " + quizList.length;
            elements.progressBar.style.width = '100%';

            if (incorrectList.length > 0) {
                elements.reviewSection.classList.remove('hidden');
                elements.wrongCount.innerText = incorrectList.length;
            } else {
                elements.reviewSection.classList.add('hidden');
                if(isReviewMode) {
                    elements.finalScore.innerText += " (ë³µìŠµ ì™„ë£Œ!)";
                }
            }
        }

        // ì´ˆê¸° ì‹¤í–‰
        // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì—ëŸ¬ê°€ ë‚  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë”ë¯¸ ë°ì´í„° í™•ì¸
        if (vocabularyData.length > 0) {
            initQuiz();
        } else {
            alert("ë‹¨ì–´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    </script>
</body>
</html>
